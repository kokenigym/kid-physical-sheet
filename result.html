<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:image" content="https://raw.githubusercontent.com/kokenigym/kokenigym.github.io/main/assets/logo.jpg" />
  <title>ì½”í¬ë‹ˆì§ ì²´ë ¥ì¸¡ì • ê²°ê³¼ì§€</title>
  <!-- Pretendard Font -->
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700&display=swap" rel="stylesheet">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    /* (1) ê¸°ë³¸ ë©”íƒ€ ë° ìŠ¤íƒ€ì¼ ì„¤ì • */
    body {
      font-family: 'Pretendard', sans-serif;
      background: #E0F2FE;
      padding: 1rem;
    }
    .glass-card {
      background: rgba(255,255,255,0.6);
      backdrop-filter: blur(12px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border: 1px solid rgba(255,255,255,0.5);
      border-radius: 1rem;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 0.5rem;
      table-layout: fixed;
    }
    th, td {
      padding: 0.5rem;
      text-align: left;
      font-size: 0.875rem;
      word-break: keep-all;
    }
    th {
      background: #EFF6FF;
      color: #1E40AF;
      width: 40%;
    }
    td {
      background: #FFFFFF;
      width: 60%;
    }
    .title-gradient {
      background: linear-gradient(90deg, #3b82f6, #10b981);
      -webkit-background-clip: text;
      color: transparent;
      font-weight: 800;
      font-size: 1.875rem;
      text-align: center;
      margin-bottom: 2rem;
    }
    .score-bar {
      position: relative;
      width: 100%;
      height: 2rem;
      background: #f3f4f6;
      border-radius: 9999px;
      overflow: visible;
      margin-top: 1.5rem;
    }
    .score-seg {
      position: absolute;
      top: 0;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.625rem;
      font-weight: 500;
      color: white;
    }
    .threshold-label {
      position: absolute;
      top: -1.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: #9ca3af;
      transform: translateX(-50%);
    }
    .marker-line {
      position: absolute;
      bottom: 0;
      height: 100%;
      width: 2px;
      background: #1f1f1f;
      transform: translateX(-50%);
    }
    .marker-arrow {
      position: absolute;
      bottom: -0.5rem;
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 7px solid #1f1f1f;
      transform: translateX(-50%);
    }
    .marker-value {
      position: absolute;
      bottom: -2rem;
      font-size: 0.875rem;
      font-weight: 700;
      transform: translateX(-50%);
      color: #1f1f1f;
    }
    .tab-button {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      border: 1px solid #3b82f6;
      border-radius: 9999px;
      background-color: white;
      color: #3b82f6;
      transition: 0.2s;
    }
    .tab-button:hover {
      background-color: #3b82f6;
      color: white;
    }
    .active-tab {
      background-color: #3b82f6;
      color: white;
    }
  /* ë°ìŠ¤í¬íƒ‘ìš© (A4 ì‚¬ì´ì¦ˆ ìœ ì§€) */
  @media (min-width: 1140px) {
    body {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 2rem;
      background: #E0F2FE;
    }

    #wrapper { 
      width: 1140px; /* A4 í­ */
      min-height: 1123px; /* A4 ë†’ì´ */
      background: white;
      padding: 2rem;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 1rem;
    }
  }

  /* ëª¨ë°”ì¼ìš© (ìì—°ìŠ¤ëŸ½ê²Œ 100% ì‚¬ìš©) */
  @media (max-width: 1139px) {
    #wrapper {
      width: 100%;
      padding: 1rem;
      background: white;
      border-radius: 1rem;
    }
  }
.feedback-container {
  position: relative;
  display: inline-block;
}
.feedback-indicator {
  position: absolute;
  top: -3px;
  right: -3px;
  width: 8px;
  height: 8px;
  background-color: red;
  border-radius: 9999px;
  box-shadow: 0 0 6px rgba(255, 0, 0, 0.6);
  animation: pulse 1.5s infinite ease-in-out;
}
@keyframes pulse {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.4); opacity: 0.7; }
  100% { transform: scale(1); opacity: 1; }
}
.tooltip {
  position: absolute;
  top: -20px;
  left: 0;
  padding: 0.5rem 1rem;
  background-color: #99f6e4;
  color: #065f46;
  border-radius: 0.75rem;
  font-size: 0.7rem;
  font-weight: 500;
  
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  pointer-events: none;
  z-index: 10;
  max-width: 100%; /* ì¹´ë“œ ë„ˆë¹„ë¥¼ ë„˜ì§€ ì•Šê²Œ ì œí•œ */
  word-break: break-word; /* ê¸¸ë©´ ì¤„ë°”ê¿ˆ */
  white-space: normal;     /* ì—¬ëŸ¬ ì¤„ í—ˆìš© */
}
.tooltip::after {
  content: '';
  position: absolute;
  bottom: -8px;
  left: 1rem;
  border-width: 6px;
  border-style: solid;
  border-color: #99f6e4 transparent transparent transparent;
}
.tooltip-visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}
/* --- A. html2pdfê°€ ì°¸ê³ í•  í˜ì´ì§€ ë‚˜ëˆ” ê·œì¹™ --- */
.html2pdf__page-break { page-break-before: always; break-before: page; }

/* --- B. ì˜ë¦¼ ë°©ì§€: ì¹´ë“œ/í‘œ/ê·¸ë˜í”„ëŠ” ê°™ì€ í˜ì´ì§€ì— ìœ ì§€ --- */
.glass-card,
table, thead, tbody, tr, td, th,
.score-bar,
canvas,
.section, .panel, .box {
  page-break-inside: avoid;
  break-inside: avoid;
  overflow: visible !important;
}

/* --- C. ì¸ì‡„/ë‚´ë³´ë‚´ê¸° ì‹œ íš¨ê³¼ ì œê±°(ì˜ë¦¼/ì„±ëŠ¥ ì´ìŠˆ ë°©ì§€) --- */
@media print {
  body { overflow: visible !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
  #wrapper {
    width: 210mm !important;   /* A4 í­ */
    padding: 12mm !important;
    box-shadow: none !important;
    border-radius: 0 !important;
    background: #fff !important;
  }
  .glass-card { backdrop-filter: none !important; }
  /* ì ˆëŒ€/ê³ ì • í¬ì§€ì…˜ ì¥ì‹ìš”ì†ŒëŠ” ë¬¸ì œë¥¼ ì˜ ì¼ìœ¼í‚´ */
  .fixed, .sticky, header, footer { position: static !important; }
  .tooltip, .feedback-indicator { display: none !important; }
}

/* --- D. í™”ë©´ìš© ë ˆì´ì•„ì›ƒì€ ê·¸ëŒ€ë¡œ ë‘ë˜, ë‚´ë³´ë‚´ê¸° í­ì€ ì•ˆì „í•˜ê²Œ --- */
@media screen and (min-width: 1140px) {
  #wrapper {
    /* í™”ë©´ì—ì„œëŠ” ë„“ê²Œ ë³´ì´ë˜, ë‚´ë³´ë‚´ê¸° ë•ŒëŠ” JSì—ì„œ ê°•ì œë¡œ ë§ì¶¤ */
    width: 1140px;
    min-height: 1123px;
  }
}
    
  </style>
</head>
<body>
  <div id ="wrapper">
  <h1 class="title-gradient flex justify-between items-center">
    ì½”í¬ë‹ˆì§ ì²´ë ¥ì¸¡ì • ê²°ê³¼ì§€
    <div class="flex gap-2 ml-4">
      <!--<button onclick="switchLayout('mobile')" class="tab-button text-xs">ğŸ“±</button>-->
      <!--<button onclick="switchLayout('desktop')" class="tab-button text-xs">ğŸ–¥ï¸</button>-->
    </div>
  </h1>

  <div id="contentWrapper" class="flex flex-col md:flex-row md:justify-center md:items-start md:gap-8">
    <!-- (2) ê¸°ë³¸ ì •ë³´ ì¹´ë“œ -->
    <div class="md:w-1/2">
      <div class="glass-card text-left">
        <h2 class="text-lg font-bold text-indigo-700 mb-4">ê¸°ë³¸ ì •ë³´</h2>
        <table>
          <tbody>
            <tr><th>ì´ë¦„</th><td id="nameCell">-</td></tr>
            <tr><th>ì„±ë³„</th><td id="genderCell">-</td></tr>
            <tr><th>ìƒë…„ì›”ì¼</th><td id="birthCell">-</td></tr>
            <tr><th>ì¸¡ì •ì¼</th><td id="measureDateCell">-</td></tr>
          </tbody>
        </table>
      </div>

      <!-- (3) ì‹ ì²´ì¡°ì„± í‰ê°€ ì¹´ë“œ -->
      <div class="glass-card text-left">
        <h2 class="text-lg font-bold text-indigo-700 mb-4">ì‹ ì²´ì¡°ì„± í‰ê°€</h2>
        <table>
          <tbody>
            <tr><th>ì‹ ì¥ (cm)</th><td id="heightCell">-</td></tr>
            <tr><th>ì²´ì¤‘ (kg)</th><td id="weightCell">-</td></tr>
          </tbody>
        </table>
        <div id="averageInfo" class="text-xs text-right text-gray-500 mt-1">
          -
        </div>
        <h3 class="text-md font-semibold text-indigo-600 mt-6 mb-2">BMI í‰ê°€</h3>
        <div class="score-bar">
          <div class="score-seg bg-blue-400" style="left:0; width:25%;">ì €ì²´ì¤‘</div>
          <div class="score-seg bg-green-400" style="left:25%; width:20%;">ì •ìƒ</div>
          <div class="score-seg bg-yellow-400" style="left:45%; width:20%;">ê³¼ì²´ì¤‘</div>
          <div class="score-seg bg-orange-400" style="left:65%; width:35%; border-top-right-radius:9999px; border-bottom-right-radius:9999px;">ë¹„ë§Œ</div>
          <span class="threshold-label" style="left:25%;">18.5</span>
          <span class="threshold-label" style="left:45%;">23</span>
          <span class="threshold-label" style="left:65%;">25</span>
          <div id="bmiMarkerLine" class="marker-line"></div>
          <div id="bmiMarkerArrow" class="marker-arrow"></div>
          <span id="bmiMarkerValue" class="marker-value">-</span>
        </div>
      </div>
    </div>

    <!-- (4) ì²´ë ¥ ì¢…í•© ì¹´ë“œ (ë ˆì´ë” ì°¨íŠ¸) -->
    <div class="md:w-1/2">
      <div class="glass-card text-left">
        <h2 class="text-lg font-bold text-indigo-700 mb-4">ì²´ë ¥ ì¸¡ì • ì¢…í•©</h2>
        <canvas id="radarChart" width="300" height="300"></canvas>
        <div id="totalScore" class="text-center mt-6 text-2xl font-bold text-indigo-700"></div>

      </div>
    </div>
  </div>
  <!-- (5) í•­ëª©ë³„ ì„¸ë¶€ í‰ê°€ ì„¹ì…˜ -->
  <div class="glass-card text-left">
    <h2 class="text-lg font-bold text-indigo-700 mb-4">í•­ëª©ë³„ ì„¸ë¶€ í‰ê°€</h2>
    <div id="detailCards" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
  </div>

  <!-- (6) ë²„íŠ¼ ì˜ì—­ -->
  <div class="flex justify-center gap-4 my-8">
    <button onclick="openReferenceModal()" class="tab-button">ì°¸ê³  ê¸°ì¤€ ë³´ê¸°</button>
    <button onclick="downloadPDF()" class="tab-button">PDF ì €ì¥í•˜ê¸°</button>
  </div>

  <!-- (7) ìƒë‹´ ë¬¸ì˜ -->
  <div class="text-center text-sm text-gray-600 mt-10">
    ìƒë‹´ë¬¸ì˜ : 010-5380-5840<br>
    <a href="https://linktr.ee/Kokenigym" target="_blank" class="text-blue-600 underline">ì½”í¬ë‹ˆì§ Linktree ë°”ë¡œê°€ê¸°</a>
  </div>

  <!-- (8) ì¸¡ì • ë°©ë²• ëª¨ë‹¬ -->
  <div id="methodModal" class="hidden fixed inset-0 w-full h-full flex items-center justify-center bg-black bg-opacity-40 z-50">
    <div class="bg-white rounded-lg p-6 w-11/12 max-w-md shadow-lg">
      <h3 id="methodTitle" class="text-lg font-bold mb-4 text-center text-indigo-700"></h3>
      <p id="methodDesc" class="text-sm text-gray-700 mb-4 text-center"></p>
      <div class="text-center">
        <button onclick="closeMethodModal()" class="bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-1 px-4 rounded-full text-sm">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- (9) ë©˜íŠ¸ ìˆ˜ì • ëª¨ë‹¬ -->
  <div id="editCommentModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white rounded-xl p-8 w-11/12 max-w-md shadow-2xl">
      <h3 id="editCommentTitle" class="text-lg font-bold text-center text-indigo-700 mb-4">ë©˜íŠ¸ ìˆ˜ì •</h3>
      <p id="editCommentLabel" class="text-center text-gray-600 mb-2 text-sm"></p>
      <textarea id="editCommentInput" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-400 mb-4" rows="4"></textarea>
      <div class="flex justify-end space-x-4">
        <button onclick="closeEditCommentModal()" class="px-4 py-2 rounded-full bg-gray-300 hover:bg-gray-400 text-sm font-semibold">ì·¨ì†Œ</button>
        <button onclick="saveEditedComment()" class="px-4 py-2 rounded-full bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-semibold">ì €ì¥</button>
      </div>
    </div>
  </div>
  
    
  <!-- (10) ì°¸ê³  ê¸°ì¤€ ëª¨ë‹¬ -->
  <div id="referenceModal" class="hidden fixed inset-0 w-full h-full flex items-center justify-center bg-black bg-opacity-30 z-50">
    <div class="bg-white rounded-lg p-6 w-11/12 max-w-2xl shadow-lg">
      <h3 class="text-lg font-bold mb-6 text-center text-indigo-700">ì°¸ê³  ê¸°ì¤€í‘œ</h3>
      <!--<div class="flex justify-center mb-6 space-x-2">-->
        <!--<button onclick="showYouthStandard()" class="tab-button active-tab">5~11ì„¸(ì½”í¬ë‹ˆì§)</button>-->
        <!--<button onclick="showPAPSStandard()" class="tab-button">12ì„¸ ì´ìƒ(PAPS)</button>-->
     <!-- </div> -->
      <div id="youthStandard" class="overflow-x-auto mb-4"></div>
      <div id="papsStandard" class="hidden overflow-x-auto mb-4"></div>
      <div class="text-center mt-6">
        <button onclick="closeReferenceModal()" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- (11) ì „ì²´ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ ì‹œì‘ -->
  <script>
    // (11-1) ì•ˆì „í•˜ê²Œ ê°’ í‘œì‹œ í•¨ìˆ˜
    function safe(v) {
      return (v !== undefined && v !== null && v !== '') ? v : '-';
    }

    // (11-2) URL íŒŒë¼ë¯¸í„° ì½ê¸°
    function getParams() {
      const p = new URLSearchParams(window.location.search);
      return {
        name: p.get('name') || '',
        gender: p.get('gender') || '',
        birth: p.get('birth') || '',
        measureDate: p.get('measureDate') || '',
        height: p.get('height') ? parseFloat(p.get('height')) : undefined,
        weight: p.get('weight') ? parseFloat(p.get('weight')) : undefined,
        tests: [
          { label:'ìœ ì—°ì„±', t1:p.get('t01')?parseFloat(p.get('t01')):undefined, t2:p.get('t02')?parseFloat(p.get('t02')):undefined },
          { label:'ê·¼ë ¥',   t1:p.get('t11')?parseFloat(p.get('t11')):undefined, t2:p.get('t12')?parseFloat(p.get('t12')):undefined },
          { label:'ìˆœë°œë ¥', t1:p.get('t21')?parseFloat(p.get('t21')):undefined, t2:p.get('t22')?parseFloat(p.get('t22')):undefined },
          { label:'ë¯¼ì²©ì„±', t1:p.get('t31')?parseFloat(p.get('t31')):undefined, t2:p.get('t32')?parseFloat(p.get('t32')):undefined },
          { label:'í‰í˜•ì„±', t1:p.get('t41')?parseFloat(p.get('t41')):undefined, t2:p.get('t42')?parseFloat(p.get('t42')):undefined },
          { label:'í˜‘ì‘ì„±', t1:p.get('t51')?parseFloat(p.get('t51')):undefined, t2:p.get('t52')?parseFloat(p.get('t52')):undefined }
        ]
      };
    }

    // (11-3) ë‚˜ì´ ê³„ì‚°
    function calculateAge(b, m) {
      if (!b || !m) return '';
      const bd = new Date(b), md = new Date(m);
      let age = md.getFullYear() - bd.getFullYear() + 1;
      //const mm = md.getMonth() - bd.getMonth();
      //if (mm < 0 || (mm === 0 && md.getDate() < bd.getDate())) age--;
      return age;
    }
    // (11-4) BMI ì¢Œí‘œ ê³„ì‚°
    function bmiToPosition(bmi) {
      if (bmi < 18.5) return (bmi / 18.5) * 25;
      if (bmi < 23) return 25 + (bmi - 18.5) / 4.5 * 20;
      if (bmi < 25) return 45 + (bmi - 23) / 2 * 20;
      return 65 + (bmi - 25) / 5 * 35;
    }

    // (11-5) ê¸°ë³¸ ì •ë³´ í‘œì‹œ ì„¸íŒ…
    function setupBasicInfo(d) {
      document.getElementById('nameCell').innerText = safe(d.name);
      document.getElementById('genderCell').innerText = safe(d.gender);
      document.getElementById('birthCell').innerText = safe(d.birth) + (d.birth && d.measureDate ? ` ${calculateAge(d.birth, d.measureDate)}` : '');
      document.getElementById('measureDateCell').innerText = safe(d.measureDate);
      document.getElementById('heightCell').innerText = safe(d.height);
      document.getElementById('weightCell').innerText = safe(d.weight);

      const bmi = (d.height && d.weight) ? (d.weight / ((d.height / 100) ** 2)).toFixed(1) : '-';
      if (bmi !== '-') {
        const mk = bmiToPosition(parseFloat(bmi));
        document.getElementById('bmiMarkerLine').style.left = mk + '%';
        document.getElementById('bmiMarkerArrow').style.left = mk + '%';
        document.getElementById('bmiMarkerValue').style.left = mk + '%';
        document.getElementById('bmiMarkerValue').innerText = bmi;
      }      
      if (d.height && d.weight && d.gender && d.birth && d.measureDate) {
        const heightCell = document.getElementById('heightCell');
        const weightCell = document.getElementById('weightCell');
        const genderCell = document.getElementById('genderCell');
        
    
        const birthYear = new Date(d.birth).getFullYear();
        const measureYear = new Date(d.measureDate).getFullYear();
        let age = measureYear - birthYear + 1;

        displayAverage(heightCell, weightCell, d.gender, d.birth, d.measureDate)

    }

    }

    // (11-6) ë ˆì´ë” ì°¨íŠ¸ ê·¸ë¦¬ê¸°
    function drawRadarChart(tests) {
  const ctx = document.getElementById('radarChart').getContext('2d');

  const scoreList = tests.map(t => {
    const s1 = calculateScore(t.label, t.t1);
    const s2 = calculateScore(t.label, t.t2);
    return (s1 + s2) / (t.t1 && t.t2 ? 2 : 1);
  });

  const totalScore = Math.round(scoreList.reduce((a, b) => a + b, 0));
  const averageScore = Math.round(totalScore / tests.length);

  let grade = '';
  if (averageScore >= 90) grade = '1ë“±ê¸‰ (ë§¤ìš° ìš°ìˆ˜)';
  else if (averageScore >= 70) grade = '2ë“±ê¸‰ (ìš°ìˆ˜)';
  else if (averageScore >= 50) grade = '3ë“±ê¸‰ (ë³´í†µ)';
  else if (averageScore >= 30) grade = '4ë“±ê¸‰ (ë¯¸í¡)';
  else grade = '5ë“±ê¸‰ (ë§¤ìš° ë¯¸í¡)';

  const totalScoreDiv = document.getElementById('totalScore');
  if (totalScoreDiv) {
    totalScoreDiv.innerHTML = `
      ì´ì  <span class="text-3xl text-green-600">${totalScore}ì </span> /
      í‰ê·  <span class="text-xl text-indigo-700">${averageScore}ì </span><br>
      <span class="text-lg font-semibold">${grade}</span>
    `;
  }

  new Chart(ctx, {
    type: 'radar',
    data: {
      labels: tests.map(t => t.label),
      datasets: [
        {
          label: '1íšŒ ì¸¡ì •',
          data: tests.map(t => calculateScore(t.label, t.t1)),
          fill: true,
          backgroundColor: 'rgba(59,130,246,0.2)',
          borderColor: 'rgba(59,130,246,1)'
        },
        {
          label: '2íšŒ ì¸¡ì •',
          data: tests.map(t => calculateScore(t.label, t.t2)),
          fill: true,
          backgroundColor: 'rgba(16,185,129,0.2)',
          borderColor: 'rgba(16,185,129,1)'
        }
      ]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'top' } },
      scales: {
        r: {
          suggestedMin: 0,
          suggestedMax: 100,
          ticks: { stepSize: 20 }
        }
      }
    }
  });
}

    // (11-7) ë“±ê¸‰ë³„ ë©˜íŠ¸ ë°ì´í„°
    const gradeComments = {
      ìœ ì—°ì„±: [
        "ë§¤ìš° í›Œë¥­í•œ ìœ ì—°ì„±ì„ ê°€ì§€ê³  ìˆì–´ìš”! ê³„ì† ìŠ¤íŠ¸ë ˆì¹­ ìŠµê´€ì„ ìœ ì§€í•˜ì„¸ìš”.",
        "ì¢‹ì€ ìœ ì—°ì„±ì…ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ê¾¸ì¤€íˆ ê´€ë¦¬í•˜ë©´ ê¸ˆë°© ìµœê³  ìˆ˜ì¤€ì— ë„ë‹¬í•  ìˆ˜ ìˆì–´ìš”!",
        "ê¸°ë³¸ì ì¸ ìœ ì—°ì„±ì€ ê°–ì¶”ì—ˆì–´ìš”. ìŠ¤íŠ¸ë ˆì¹­ ì‹œê°„ì„ ëŠ˜ë ¤ë³¼ê¹Œìš”?",
        "ì•„ì§ ìœ ì—°ì„±ì´ ë¶€ì¡±í•´ìš”. í•˜ë£¨ 5ë¶„ì”© ê¾¸ì¤€íˆ ì—°ìŠµí•˜ë©´ ì¢‹ì•„ì§ˆ ê±°ì˜ˆìš”!"
      ],
      ê·¼ë ¥: [
        "ê·¼ë ¥ì´ ë§¤ìš° íƒ„íƒ„í•©ë‹ˆë‹¤! ê¾¸ì¤€í•œ ìš´ë™ ìŠµê´€ì´ ëŠê»´ì ¸ìš”.",
        "ê·¼ë ¥ì´ ì¢‹ì€ í¸ì´ì—ìš”. í˜„ì¬ ìš´ë™ì„ ê¾¸ì¤€íˆ ì´ì–´ê°€ì„¸ìš”!",
        "í‰ê· ì ì¸ ê·¼ë ¥ì…ë‹ˆë‹¤. ì¡°ê¸ˆ ë” ê·¼ì§€êµ¬ë ¥ ìš´ë™ì„ ì¶”ê°€í•´ë³´ì„¸ìš”.",
        "ê·¼ë ¥ í–¥ìƒì´ í•„ìš”í•©ë‹ˆë‹¤. ê²Œì„ì²˜ëŸ¼ ì¬ë¯¸ìˆê²Œ ìš´ë™ì„ ì‹œì‘í•´ë³¼ê¹Œìš”?"
      ],
      ìˆœë°œë ¥: [
        "ìˆœë°œë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤! í­ë°œì ì¸ í˜ì„ ì˜ í™œìš©í•˜ì„¸ìš”.",
        "ìˆœë°œë ¥ ì¢‹ì€ í¸ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ì í”„ ë†€ì´ë¥¼ ì¶”ì²œí•´ìš”!",
        "ìˆœë°œë ¥ì€ í‰ê·  ì •ë„ì˜ˆìš”. ì í”„ í›ˆë ¨ì„ í•´ë³´ë©´ ê¸ˆë°© í–¥ìƒë  ìˆ˜ ìˆì–´ìš”.",
        "ìˆœë°œë ¥ì´ ì•½í•œ í¸ì…ë‹ˆë‹¤. ì§§ì€ ê±°ë¦¬ ë›°ê¸° ë†€ì´ë¥¼ ìì£¼ í•´ë´ìš”!"
      ],
      ë¯¼ì²©ì„±: [
        "ë¯¼ì²©ì„±ì´ ì•„ì£¼ ë›°ì–´ë‚©ë‹ˆë‹¤! ë°©í–¥ ì „í™˜ì´ ë¹ ë¥´ë„¤ìš”!",
        "ë¯¼ì²©ì„±ì´ ì¢‹ì•„ìš”. ë¯¼ì²©ì„± ê²Œì„ì„ í•¨ê»˜ ì¶”ê°€í•´ë³´ì„¸ìš”!",
        "ë¯¼ì²©ì„±ì€ í‰ê· ì´ì—ìš”. ë‹¤ì–‘í•œ ë¦¬ë“¬ìš´ë™ì„ ì¶”ì²œí•©ë‹ˆë‹¤.",
        "ë¯¼ì²©ì„±ì´ ì•„ì§ ë¶€ì¡±í•´ìš”. ì¦ê²ê²Œ ë‹¬ë¦¬ê¸° ë†€ì´ë¥¼ ìì£¼ í•´ë´ìš”!"
      ],
      í‰í˜•ì„±: [
        "í‰í˜•ê°ê°ì´ ë§¤ìš° í›Œë¥­í•©ë‹ˆë‹¤! ëª¸ì˜ ê· í˜•ì´ ì¢‹ì•„ìš”.",
        "ì¢‹ì€ í‰í˜•ì„±ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ìì„¸ë¡œ ê· í˜• ì—°ìŠµì„ í•´ë³´ì„¸ìš”!",
        "í‰í˜•ì„±ì€ í‰ê·  ìˆ˜ì¤€ì…ë‹ˆë‹¤. ê°„ë‹¨í•œ ìš”ê°€ ë™ì‘ë„ ë„ì›€ì´ ë¼ìš”.",
        "í‰í˜•ì„±ì´ ì•½í•œ í¸ì…ë‹ˆë‹¤. í•œë°œì„œê¸° ê²Œì„ì„ ë§¤ì¼ í•´ë³´ì„¸ìš”!"
      ],
      í˜‘ì‘ì„±: [
        "í˜‘ì‘ë ¥ì´ ì•„ì£¼ ë›°ì–´ë‚©ë‹ˆë‹¤! ëª¸ê³¼ ì†ì˜ ì¡°í™”ê°€ ë©‹ì ¸ìš”.",
        "í˜‘ì‘ì„± ì¢‹ì€ í¸ì…ë‹ˆë‹¤. ë‹¤ì–‘í•œ ê³µë†€ì´ë¥¼ ë” ì‹œë„í•´ë³´ì„¸ìš”!",
        "í˜‘ì‘ì„±ì€ í‰ê·  ìˆ˜ì¤€ì…ë‹ˆë‹¤. íŒ¨í„´ ê²Œì„ì„ ì¶”ì²œí•´ìš”.",
        "í˜‘ì‘ë ¥ì´ ì•„ì§ ë¶€ì¡±í•´ìš”. ì¬ë¯¸ìˆëŠ” ìºì¹˜ ë†€ì´ë¡œ í‚¤ì›Œë´ìš”!"
      ]
    };
    // (11-8) ì¸¡ì • ë°©ë²• ì„¤ëª…
    const methods = [
      { title: 'ì¢Œì „êµ´ (Sit and Reach Test)', desc: 'ì•‰ì€ ìì„¸ì—ì„œ ìƒì²´ë¥¼ ì•ìœ¼ë¡œ êµ½í˜€ ì†ëì´ ë‹¿ëŠ” ê±°ë¦¬ë¥¼ ì¸¡ì •í•˜ì—¬ ìœ ì—°ì„±ì„ í‰ê°€í•©ë‹ˆë‹¤.' },
      { title: 'ìœ—ëª¸ ì¼ìœ¼í‚¤ê¸° (Sit-up Test)', desc: '1ë¶„ ë™ì•ˆ ê°€ëŠ¥í•œ ë§ì€ ìœ—ëª¸ ì¼ìœ¼í‚¤ê¸°ë¥¼ í•˜ì—¬ ê·¼ë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.' },
      { title: 'ì œìë¦¬ë©€ë¦¬ë›°ê¸° (Standing Long Jump)', desc: 'ì œìë¦¬ì—ì„œ ë‘ ë°œë¡œ ë©€ë¦¬ ë›°ì–´ ìˆœë°œë ¥ì„ í‰ê°€í•©ë‹ˆë‹¤.' },
      { title: 'ì¥ì• ë¬¼ ì™•ë³µë‹¬ë¦¬ê¸° (Shuttle Run)', desc: 'ì§§ì€ ê±°ë¦¬ êµ¬ê°„ì„ ë°˜ë³µí•˜ì—¬ ë‹¬ë¦¬ëŠ” ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ ë¯¼ì²©ì„±ì„ í‰ê°€í•©ë‹ˆë‹¤.' },
      { title: 'í•œë°œì„œê¸° (One-leg Stand)', desc: 'í•œ ë°œë¡œ ë²„í‹°ëŠ” ì‹œê°„ì„ ì¸¡ì •í•˜ì—¬ í‰í˜•ì„±ì„ í‰ê°€í•©ë‹ˆë‹¤.' },
      { title: 'ê³µì¡ê¸° (Ball Catching)', desc: 'ì œí•œëœ ì‹œê°„ ë™ì•ˆ ê³µì„ ì¡ëŠ” íšŸìˆ˜ë¡œ í˜‘ì‘ì„±ì„ í‰ê°€í•©ë‹ˆë‹¤.' }
    ];

    // (11-9) ë“±ê¸‰ ê³„ì‚°
    function getGrade(score, cat) {
      if (cat === 'ë¯¼ì²©ì„±') {
        if (score <= 4.5) return 0;
        if (score <= 5.5) return 1;
        if (score <= 6.5) return 2;
        return 3;
      }
      if (cat === 'í˜‘ì‘ì„±') {
        if (score >= 3) return 0;
        if (score >= 2) return 1;
        if (score >= 1) return 2;
        return 3;
      }
      if (cat === 'ìˆœë°œë ¥') {
        if (score >= 140) return 0;
        if (score >= 120) return 1;
        if (score >= 100) return 2;
        return 3;
      }
      if (cat === 'ê·¼ë ¥') {
        if (score >= 60) return 0;
        if (score >= 40) return 1;
        if (score >= 20) return 2;
        return 3;
      }
      if (cat === 'ìœ ì—°ì„±') {
        if (score >= 13) return 0;
        if (score >= 10) return 1;
        if (score >= 5) return 2;
        return 3;
      }
      if (cat === 'í‰í˜•ì„±') {
        if (score >= 60) return 0;
        if (score >= 40) return 1;
        if (score >= 20) return 2;
        return 3;
      }
      return 3;
    }

    const firstGradeCriteria = {
        'ìœ ì—°ì„±': {
          5: 13, 6: 13, 7: 13, 8: 13, 9: 13,
          10: 13, 11: 13, 12: 15, 13: 15, 14: 15, 15: 15, 16: 15, 17: 15, 18: 15
        },
        'ê·¼ë ¥': {
          5: 60, 6: 60, 7: 60, 8: 60, 9: 60,
          10: 60, 11: 60, 12: 35, 13: 35, 14: 35, 15: 35, 16: 35, 17: 35, 18: 35
        },
        'ìˆœë°œë ¥': {
          5: 120, 6: 120, 7: 120, 8: 140, 9: 140,
          10: 160, 11: 160, 12: 160, 13: 160, 14: 160, 15: 160, 16: 160, 17: 160, 18: 160
        },
        'ë¯¼ì²©ì„±': {
          5: 4.5, 6: 4.5, 7: 4.5, 8: 4.5, 9: 4.5,
          10: 4.5, 11: 4.5, 12: 10, 13: 10, 14: 10, 15: 10, 16: 10, 17: 10, 18: 10
        },
        'í‰í˜•ì„±': {
          5: 60, 6: 60, 7: 60, 8: 60, 9: 60,
          10: 60, 11: 60, 12: 60, 13: 60, 14: 60, 15: 60, 16: 60, 17: 60, 18: 60
        },
        'í˜‘ì‘ì„±': {
          5: 3, 6: 3, 7: 3, 8: 3, 9: 3,
          10: 3, 11: 3, 12: 60, 13: 60, 14: 60, 15: 60, 16: 60, 17: 60, 18: 60
        }
      };
    
    function calculateScore(label,value){
        if (value === undefined || value === null || isNaN(value))return 0;
        const age = userAge;
        const standard = firstGradeCriteria[label] ? firstGradeCriteria[label][age] : null;
        let score = 0;
        if (value !== undefined && value !== null){       
            if (label === 'ë¯¼ì²©ì„±') {
                score = standard / value;  // ë¯¼ì²©ì„±ì€ ë‚˜ëˆ„ê¸°ë¡œ ê³„ì‚°                
            } else {
                score = value / standard;  // ë‚˜ë¨¸ì§€ í•­ëª©ì€ ë‚˜ëˆ„ê¸° ë°©ì‹ìœ¼ë¡œ                
            }
            score = score >= 1 ? 100 : Math.ceil(score * 100); // 1ì„ ë„˜ìœ¼ë©´ 100ì , ì•„ë‹ˆë©´ ë¹„ë¡€ ê³„ì‚°
            return Math.min(100,Math.ceil(score));
        }        
    }
    
      
    // (11-10) ì„¸ë¶€ ì¹´ë“œ ìƒì„±
    function createDetailCards(tests) {
      const c = document.getElementById('detailCards');
      c.innerHTML = '';
      tests.forEach((t, i) => {
        const m = methods[i], lbl = t.label, grd = (t.t1 !== undefined) ? getGrade(t.t1, lbl) : 3;
        const cm = gradeComments[lbl][grd];
        const feedbackTips = {
  ìœ ì—°ì„±: {
    A: "ë™ë¬¼ í‰ë‚´ ìŠ¤íŠ¸ë ˆì¹­ ë†€ì´ë¥¼ í•´ë´ìš”! ì˜ˆ: ê³ ì–‘ì´ ìì„¸, ë±€ì²˜ëŸ¼ ê¸°ì–´ê°€ê¸°",
    B: "ì¤„ë„˜ê¸° ì „ì— ìŠ¤íŠ¸ë ˆì¹­ ë£¨í‹´ì„ ë§Œë“¤ê³  ë”°ë¼í•´ë³´ì„¸ìš”!",
    C: "í–„ìŠ¤íŠ¸ë§, í—ˆë¦¬ ìœ ì—°ì„± ëŠ˜ë¦¬ëŠ” ìš”ê°€ ë™ì‘ì„ í•´ë³´ì„¸ìš” (ì˜ˆ: ë‹¤ìš´ë…, ì „êµ´)"
  },
  ê·¼ë ¥: {
    A: "ë²½ ë°€ê¸°, ì§ë³¼ ìœ„ì— ì•‰ì•„ ê· í˜•ì¡ê¸° ë†€ì´ë¥¼ í•´ë³´ì„¸ìš”!",
    B: "ìŠ¤ì¿¼íŠ¸ 5íšŒì”© ê²Œì„ì²˜ëŸ¼ ë„ì „í•´ë³´ì„¸ìš”! íšŸìˆ˜ ëŠ˜ë¦¬ê¸° ëª©í‘œ ì¶”ì²œ!",
    C: "í”Œë­í¬, í‘¸ì‰¬ì—… ë“± ë§¨ëª¸ ê·¼ë ¥ìš´ë™ì„ ì£¼ê¸°ì ìœ¼ë¡œ í•´ë³´ì„¸ìš”."
  },
  ìˆœë°œë ¥: {
    A: "ì¤„ ìœ„ë¡œ ì í”„ ë†€ì´, ìƒ‰ê¹”í‘œ ìœ„ ì í”„ê²Œì„ì„ í•´ë³´ì„¸ìš”!",
    B: "ì œìë¦¬ ë©€ë¦¬ë›°ê¸° ëª©í‘œë¥¼ ì •í•˜ê³  ê¸°ë¡ê¹¨ê¸° ê²Œì„ì„ í•´ë³´ì„¸ìš”!",
    C: "ë°˜ì‘ì†ë„ ê²Œì„(ì§ì§ì´, ë¶ˆë¹› ë°˜ì‘)ì„ í™œìš©í•œ ìˆœë°œë ¥ í›ˆë ¨ì„ í•´ë³´ì„¸ìš”."
  },
  ë¯¼ì²©ì„±: {
    A: "ì½˜ ì¥ì• ë¬¼ ë„˜ê¸° ê²Œì„ìœ¼ë¡œ ë°©í–¥ ë°”ê¾¸ê¸° ì—°ìŠµí•´ìš”!",
    B: "ì§€ê·¸ì¬ê·¸ ë‹¬ë¦¬ê¸° ê²Œì„, ë¬´ì‘ìœ„ ëª…ë ¹ ë°˜ì‘ ê²Œì„ì„ í•´ë³´ì„¸ìš”.",
    C: "ì…”í‹€ ëŸ° í›ˆë ¨ì´ë‚˜ ì‚¬ì´ë“œ ìŠ¤í… í›ˆë ¨ì„ ì¶”ì²œí•´ìš”."
  },
  í‰í˜•ì„±: {
    A: "í•œ ë°œë¡œ ì˜¤ë˜ ì„œê¸° ë†€ì´ë¥¼ í•´ë³´ì„¸ìš”! ì¸í˜• ì˜®ê¸°ê¸° ë¯¸ì…˜ë„ ì¬ë¯¸ìˆì–´ìš”!",
    B: "ê· í˜•ë³´ë“œ, ì¿ ì…˜ ìœ„ì—ì„œ í•œë°œë¡œ ì„œë³´ê¸° ì±Œë¦°ì§€!",
    C: "ìì„¸ ìœ ì§€ í›ˆë ¨ (ì˜ˆ: ì›Œë¦¬ì–´ í¬ì¦ˆ, ìš”ê°€ ë‚˜ë¬´ìì„¸)ë¡œ ê· í˜•ê°ê°ì„ í‚¤ìš°ì„¸ìš”."
  },
  í˜‘ì‘ì„±: {
    A: "ìƒ‰ê¹”ê³µ ë˜ì§€ê¸°-ë°›ê¸° ë†€ì´! ì†ë°œ ë™ì‹œ ì‚¬ìš© ë†€ì´ë¡œ í˜‘ì‘ë ¥ í‚¤ì›Œìš”.",
    B: "ë¦¬ë“¬ íƒ€ë©° íƒ¬ë²„ë¦° ë‘ë“œë¦¬ê¸°, íƒêµ¬ ë“± ê³µë†€ì´ ì¶”ì²œ!",
    C: "ì–‘ì† ë…ë¦½ ì›€ì§ì„ ê²Œì„(ë“œëŸ¼, íƒ€ì ì—°ìŠµ ë“±)ì„ í™œìš©í•´ë³´ì„¸ìš”."
  }
};



        const age = userAge; // ì‚¬ìš©ì ë‚˜ì´ (ë¯¸ë¦¬ ê³„ì‚°í•´ì„œ ì„¸íŒ…í•œ ê°’)
        // ì—°ë ¹ ë¶„ë¥˜ ë° í”¼ë“œë°± ì‚½ì… ì¡°ê±´
        const group = age ? getAgeGroup(parseInt(age)) : null;
        const tip = (grd >= 2 && group && feedbackTips[lbl] && feedbackTips[lbl][group]) ? feedbackTips[lbl][group] : null;
        
        const criteriaValue = firstGradeCriteria[lbl] ? firstGradeCriteria[lbl][age] : null;
        const firstValue = t.t1; // 1íšŒ ì¸¡ì •ê°’
        let score = 0;

        // 1ë“±ê¸‰ ê¸°ì¤€ì„ ë‚˜ì´ì— ë§ê²Œ ì„¤ì •í•œ í›„ ì ìˆ˜ ê³„ì‚°
        if (firstValue !== undefined && criteriaValue !== null) {
        if (lbl === 'ë¯¼ì²©ì„±') {
            score = criteriaValue / firstValue;  // ë¯¼ì²©ì„±ì€ ë‚˜ëˆ„ê¸°ë¡œ ê³„ì‚°
        } else {
            score = firstValue / criteriaValue;  // ë‚˜ë¨¸ì§€ í•­ëª©ì€ ë‚˜ëˆ„ê¸° ë°©ì‹ìœ¼ë¡œ
        }
            score = score >= 1 ? 100 : Math.ceil(score * 100); // 1ì„ ë„˜ìœ¼ë©´ 100ì , ì•„ë‹ˆë©´ ë¹„ë¡€ ê³„ì‚°
        }


        // ë“±ê¸‰ì— ë”°ë¥¸ í…ìŠ¤íŠ¸ ì„¤ì •
        const gradeText = ['ë§¤ìš°ìš°ìˆ˜', 'ìš°ìˆ˜', 'ë³´í†µ', 'ë…¸ë ¥í•„ìš”'][grd];
        const gradeColor = ['bg-blue-400', 'bg-green-400', 'bg-yellow-400', 'bg-red-400'][grd];

        const card = document.createElement('div');
        card.className = 'glass-card text-left';
        card.innerHTML = `
         <div class="flex justify-between items-center mb-2 relative cursor-pointer" onclick="toggleFeedback(${i})">
  <h2 class="text-md font-bold text-indigo-700">${lbl}</h2>
  <div class="text-sm font-semibold ${gradeColor} text-white px-3 py-1 rounded-full relative">
    ${gradeText}
    ${grd >= 2 ? `<span id="dot-${i}" class="feedback-indicator"></span>` : ''}
  </div>
</div>
          <div class="relative w-full h-6 bg-gray-200 rounded-full overflow-hidden">
            <div class="absolute top-0 left-0 h-full bg-indigo-400" style="width:${score}%;"></div>
            <div class="absolute w-full text-center text-xs font-bold leading-6">${score}ì </div>
          </div>

          <table class="w-full text-xs mt-4">
            <tbody>
              <tr>
                <th class="text-left w-1/3">ì¸¡ì • ë°©ë²•</th>
                <td><button onclick="openMethodModal('${m.title}','${m.desc}')" class="text-blue-600 underline">${m.title}</button></td>
              </tr>
              <tr><th class="text-left">1íšŒ ì¸¡ì •ê°’</th><td>${safe(t.t1)}</td></tr>
              <tr><th class="text-left">2íšŒ ì¸¡ì •ê°’</th><td>${safe(t.t2)}</td></tr>
            </tbody>
          </table>
          <div class="mt-3">
            <p id="comment-${i}" class="text-xs text-gray-700 leading-relaxed cursor-pointer hover:underline" onclick="editComment(${i}, '${lbl}')">${cm}</p>            
          </div>
          ${tip ? `<div id="feedback-${i}" class="tooltip" onclick="this.classList.remove('tootip-visible')">ğŸ’¡ ${tip}</div>` : ''}
        `;
        c.appendChild(card);
      });
    }
    // (12) ì¸¡ì • ë°©ë²• ëª¨ë‹¬ ì˜¤í”ˆ/í´ë¡œì¦ˆ
    function openMethodModal(title, desc) {
      document.getElementById('methodTitle').innerText = title;
      document.getElementById('methodDesc').innerText = desc;
      document.getElementById('methodModal').classList.remove('hidden');
    }
    function closeMethodModal() {
      document.getElementById('methodModal').classList.add('hidden');
    }

    // (13) ì°¸ê³  ê¸°ì¤€ ëª¨ë‹¬ ì˜¤í”ˆ/í´ë¡œì¦ˆ
    function openReferenceModal() {
      document.getElementById('referenceModal').classList.remove('hidden');
    }
    function closeReferenceModal() {
      document.getElementById('referenceModal').classList.add('hidden');
    }

    // (14) ì°¸ê³  ê¸°ì¤€í‘œ ë³´ê¸° í† ê¸€
    function showYouthStandard() {
      document.getElementById('youthStandard').classList.remove('hidden');
      document.getElementById('papsStandard').classList.add('hidden');
    }
    function showPAPSStandard() {
      document.getElementById('papsStandard').classList.remove('hidden');
      document.getElementById('youthStandard').classList.add('hidden');
    }

function downloadPDF() {
  const element = document.getElementById('wrapper');

  // A4ì™€ ì—¬ë°±(mm)
  const MARGIN_MM = 10;                 // ì¢Œ/ìš°/ìƒ/í•˜ ì—¬ë°± (mm)
  const A4_W_MM = 210, A4_H_MM = 297;
  const INNER_W_MM = A4_W_MM - MARGIN_MM * 2;
  const INNER_H_MM = A4_H_MM - MARGIN_MM * 2;

  // mm â†’ px (ë¸Œë¼ìš°ì € 96DPI ê°€ì •)
  const PX_PER_MM = 96 / 25.4;
  const TARGET_W_PX = INNER_W_MM * PX_PER_MM;
  const TARGET_H_PX = INNER_H_MM * PX_PER_MM;

  // í˜„ì¬ ì½˜í…ì¸  ì‹¤ì œ í¬ê¸° ì¸¡ì •
  const rect = element.getBoundingClientRect();
  const fullWidthPx  = rect.width;                  // ë³´ì´ëŠ” í­
  const fullHeightPx = element.scrollHeight;        // ì „ì²´ ë†’ì´(ì˜¤ë²„í”Œë¡œ í¬í•¨)

  // í•œ í˜ì´ì§€ì— ë“¤ì–´ê°€ë„ë¡ ì¶•ì†Œ ë¹„ìœ¨ ê³„ì‚°
  const ratio = Math.min(TARGET_W_PX / fullWidthPx, TARGET_H_PX / fullHeightPx, 1);

  // ì¶•ì†Œ ì ìš© (ë‚´ë³´ë‚´ê¸° ì „ìš©)
  const prevTransform = element.style.transform;
  const prevTransformOrigin = element.style.transformOrigin;
  const prevWidth = element.style.width;

  element.style.transformOrigin = 'top left';
  element.style.transform = `scale(${ratio})`;
  // scaleë¡œë§Œ ì¤„ì´ë©´ ë ˆì´ì•„ì›ƒ ê³„ì‚° ìƒ ì›ë˜ í¬ê¸°ë¡œ í˜ì´ì§€ê°€ ëŠê¸¸ ìˆ˜ ìˆì–´ widthë„ ë§ì¶°ì¤Œ
  element.style.width = `${fullWidthPx * ratio}px`;

  const opt = {
    margin:       [MARGIN_MM, MARGIN_MM, MARGIN_MM, MARGIN_MM], // mm
    filename:     'Result.pdf',
    image:        { type: 'jpeg', quality: 0.98 },
    html2canvas:  {
      scale: 2,
      useCORS: true,
      logging: false,
      scrollY: 0,
      // html2canvasê°€ ë ˆì´ì•„ì›ƒì„ ê³„ì‚°í•  ê¸°ì¤€ í­
      windowWidth: Math.ceil(fullWidthPx * ratio)
    },
    jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' },
    // í˜ì´ì§€ ë¶„í• ì€ í”¼í•˜ê³ (ì–´ì°¨í”¼ 1í˜ì´ì§€), CSS ê·œì¹™ë„ ì¡´ì¤‘
    pagebreak:    { mode: ['css', 'avoid-all'] }
  };

  html2pdf().set(opt).from(element).save().then(() => {
    // ì›ìƒë³µêµ¬
    element.style.transform = prevTransform;
    element.style.transformOrigin = prevTransformOrigin;
    element.style.width = prevWidth;
  }).catch(() => {
    // ì‹¤íŒ¨í•´ë„ ì›ë³µ
    element.style.transform = prevTransform;
    element.style.transformOrigin = prevTransformOrigin;
    element.style.width = prevWidth;
  });
}
    let currentEditIndex = null;
    // (16) í•­ëª©ë³„ ì½”ë©˜íŠ¸ ìˆ˜ì • ê¸°ëŠ¥
    function editComment(index, label) {
      currentEditIndex = index;
      document.getElementById('editCommentTitle').innerText = "ë©˜íŠ¸ ìˆ˜ì •";
      document.getElementById('editCommentLabel').innerText = `ìˆ˜ì • í•­ëª©: ${label}`;
      const oldComment = document.getElementById(`comment-${index}`).innerText;
      document.getElementById('editCommentInput').value = oldComment;
      document.getElementById('editCommentModal').classList.remove('hidden');
    }
    function openEditCommentModal(currentText, label, targetElement) {
        document.getElementById('editCommentTitle').innerText = "ë©˜íŠ¸ ìˆ˜ì •";
        document.getElementById('editCommentLabel').innerText = `ìˆ˜ì • í•­ëª©: ${label}`;
        document.getElementById('editCommentInput').value = currentText;
        document.getElementById('editCommentModal').classList.remove('hidden');
        window.currentEditTarget = targetElement;
    }

    function closeEditCommentModal() {
        document.getElementById('editCommentModal').classList.add('hidden');
    }

    function saveEditedComment() {
        const newComment = document.getElementById('editCommentInput').value.trim();
        if (newComment !== null) {
            document.getElementById(`comment-${currentEditIndex}`).innerText = newComment;
          }
        closeEditCommentModal();
    }
    // (17) ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ì „í™˜
    function switchLayout(mode) {
      const wrapper = document.getElementById('wrapper');
      if (mode === 'mobile') {
        wrapper.classList.remove('desktop-layout');
        wrapper.classList.add('mobile-layout');
      } else {
        wrapper.classList.remove('mobile-layout');
        wrapper.classList.add('desktop-layout');
      }
    }

    // (18) ëŒ€í•œë¯¼êµ­ í‰ê·  ì‹ ì¥/ì²´ì¤‘ ë°ì´í„°
    const averageData = {
      male: {
        5: { height: 110, weight: 18 },
        6: { height: 116, weight: 20 },
        7: { height: 122, weight: 22 },
        8: { height: 127, weight: 25 },
        9: { height: 133, weight: 28 },
        10: { height: 138, weight: 32 },
        11: { height: 143, weight: 36 },
        12: { height: 150, weight: 42 },
        13: { height: 157, weight: 48 },
        14: { height: 164, weight: 55 },
        15: { height: 169, weight: 61 },
        16: { height: 172, weight: 65 },
        17: { height: 174, weight: 68 },
        18: { height: 175, weight: 70 }
      },
      female: {
        5: { height: 109, weight: 17 },
        6: { height: 115, weight: 19 },
        7: { height: 120, weight: 21 },
        8: { height: 126, weight: 24 },
        9: { height: 131, weight: 27 },
        10: { height: 137, weight: 31 },
        11: { height: 143, weight: 36 },
        12: { height: 150, weight: 41 },
        13: { height: 155, weight: 46 },
        14: { height: 158, weight: 50 },
        15: { height: 160, weight: 53 },
        16: { height: 161, weight: 54 },
        17: { height: 162, weight: 55 },
        18: { height: 162, weight: 56 }
      }
    };

    // (19) í‰ê·  ì‹ ì¥/ì²´ì¤‘ í‘œì‹œ í•¨ìˆ˜
// (19) í‰ê·  ì‹ ì¥/ì²´ì¤‘ í‘œì‹œ í•¨ìˆ˜ (ìµœì‹  ìˆ˜ì • ë²„ì „)
    function displayAverage(heightCell, weightCell, gender, birthYear, measureDate) {
        const infoDiv = document.getElementById('averageInfo');  // ì¶œì²˜ì™€ í‰ê·  ë¬¸êµ¬ í‘œì‹œí•  div
        if (!infoDiv) return;
    
        // ë‚˜ì´ ê³„ì‚°
        const birth = new Date(birthYear);
        const measure = new Date(measureDate);
        let age = measure.getFullYear() - birth.getFullYear() + 1;
        //const m = measure.getMonth() - birth.getMonth();
        //if (m < 0 || (m === 0 && measure.getDate() < birth.getDate())) {
        //age--;
        //}
    
        const data = averageData[gender === 'ë‚¨ì•„' ? 'male' : 'female'][age];
    
        if (data) {
        infoDiv.innerHTML = `
            ëŒ€í•œë¯¼êµ­ ${age}ì„¸ ${gender} í‰ê·  ì‹ ì¥ ${data.height}cm / í‰ê·  ì²´ì¤‘ ${data.weight}kg<br>
            <span class="text-gray-400 text-xs">ì¶œì²˜: ëŒ€í•œì†Œì•„ì²­ì†Œë…„ê³¼í•™íšŒ 2024 ì„±ì¥í†µê³„</span>
        `;
        } else {
        infoDiv.innerHTML = `
            ëŒ€í•œë¯¼êµ­ ${age}ì„¸ ${gender} í‰ê·  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br>
            <span class="text-gray-400 text-xs">ì¶œì²˜: ëŒ€í•œì†Œì•„ì²­ì†Œë…„ê³¼í•™íšŒ 2024 ì„±ì¥í†µê³„</span>
        `;
        }
    }
    function getAgeGroup(age) {
  if (age >= 5 && age <= 8) return 'A';
  if (age >= 9 && age <= 12) return 'B';
  if (age >= 13 && age <= 18) return 'C';
  return null; // ë¯¸ì§€ì› ì—°ë ¹
    }
  function toggleFeedback(i) {
  const box = document.getElementById(`feedback-${i}`);
  const dot = document.getElementById(`dot-${i}`);
  if (box) {
    const isShown = !box.classList.contains('tooltip-visible');
    box.classList.toggle('tooltip-visible');
    if (!isShown && dot) dot.remove(); // ë§í’ì„  ì²˜ìŒ ì—´ë¦´ ë•Œ ì  ì œê±°
  }
  }

    let userAge = 0; // ì‚¬ìš©ì ë‚˜ì´ ì´ˆê¸°í™”

    // ë‚˜ì´ ê³„ì‚° í•¨ìˆ˜
    function calculateAge(birth, measureDate) {
        const birthDate = new Date(birth);
        const measure = new Date(measureDate);
        let age = measure.getFullYear() - birthDate.getFullYear() + 1;
        //const m = measure.getMonth() - birthDate.getMonth();
        //if (m < 0 || (m === 0 && measure.getDate() < birthDate.getDate())) {
        //    age--;
        // }
        userAge = age; // ë‚˜ì´ë¥¼ ê³„ì‚°í•œ í›„ userAgeì— ì €ì¥

        return `(${age}ì„¸)`; // ë‚˜ì´ ë¦¬í„´
    }

    // (20) ë¬¸ì„œê°€ ë¡œë“œëœ í›„ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', () => {
      const data = getParams();

      if (data.name) {
        setupBasicInfo(data);
        createDetailCards(data.tests);
        drawRadarChart(data.tests);
      } else {
        // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì´ˆê¸°í™”
        setupBasicInfo({
          name: '',
          gender: '',
          birth: '',
          measureDate: '',
          height: '',
          weight: ''
        });

        createDetailCards([
          { label: 'ìœ ì—°ì„±', t1: 0, t2: 0 },
          { label: 'ê·¼ë ¥', t1: 0, t2: 0 },
          { label: 'ìˆœë°œë ¥', t1: 0, t2: 0 },
          { label: 'ë¯¼ì²©ì„±', t1: 0, t2: 0 },
          { label: 'í‰í˜•ì„±', t1: 0, t2: 0 },
          { label: 'í˜‘ì‘ì„±', t1: 0, t2: 0 }
        ]);

        drawRadarChart([
          { label: 'ìœ ì—°ì„±', t1: 0, t2: 0 },
          { label: 'ê·¼ë ¥', t1: 0, t2: 0 },
          { label: 'ìˆœë°œë ¥', t1: 0, t2: 0 },
          { label: 'ë¯¼ì²©ì„±', t1: 0, t2: 0 },
          { label: 'í‰í˜•ì„±', t1: 0, t2: 0 },
          { label: 'í˜‘ì‘ì„±', t1: 0, t2: 0 }
        ]);
      }

      // ì°¸ê³  ê¸°ì¤€í‘œ ë°ì´í„° ì‚½ì…
      document.getElementById('youthStandard').innerHTML = `
        <table class="w-full text-xs table-auto border">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
                <th class="p-2 border">í•­ëª©</th><th class="p-2 border">1ë“±ê¸‰</th><th class="p-2 border">2ë“±ê¸‰</th><th class="p-2 border">3ë“±ê¸‰</th><th class="p-2 border">4ë“±ê¸‰</th>
              </tr>
            </thead>
            <tbody>
              <tr><td class="p-2 border">ìœ ì—°ì„± (ì¢Œì „êµ´)</td><td class="p-2 border">13cm ì´ìƒ</td><td class="p-2 border">10~12cm</td><td class="p-2 border">5~9cm</td><td class="p-2 border">5cm ë¯¸ë§Œ</td></tr>
              <tr><td class="p-2 border">ê·¼ë ¥â€¢ê·¼ì§€êµ¬ë ¥ (Wall Sit)</td><td class="p-2 border">60ì´ˆ ì´ìƒ</td><td class="p-2 border">40~59ì´ˆ</td><td class="p-2 border">20~39ì´ˆ</td><td class="p-2 border">20ì´ˆ ë¯¸ë§Œ</td></tr>
              <tr><td class="p-2 border">ìˆœë°œë ¥ (5~7ì„¸)</td><td class="p-2 border">120cm ì´ìƒ</td><td class="p-2 border">100~119cm</td><td class="p-2 border">80~99cm</td><td class="p-2 border">79cm ì´í•˜</td></tr>
              <tr><td class="p-2 border">ìˆœë°œë ¥ (8~9ì„¸)</td><td class="p-2 border">140cm ì´ìƒ</td><td class="p-2 border">120~139cm</td><td class="p-2 border">100~119cm</td><td class="p-2 border">99cm ì´í•˜</td></tr>
              <tr><td class="p-2 border">ìˆœë°œë ¥ (10~11ì„¸)</td><td class="p-2 border">160cm ì´ìƒ</td><td class="p-2 border">140~159cm</td><td class="p-2 border">120~139cm</td><td class="p-2 border">119cm ì´í•˜</td></tr>
              <tr><td class="p-2 border">ë¯¼ì²©ì„± (ì™•ë³µë‹¬ë¦¬ê¸°)</td><td class="p-2 border">4.5ì´ˆ ì´í•˜</td><td class="p-2 border">4.6~5.5ì´ˆ</td><td class="p-2 border">5.6~6.5ì´ˆ</td><td class="p-2 border">6.6ì´ˆ ì´ìƒ</td></tr>
              <tr><td class="p-2 border">í‰í˜•ì„± (í•œë°œì„œê¸°)</td><td class="p-2 border">60ì´ˆ ì´ìƒ</td><td class="p-2 border">40~59ì´ˆ</td><td class="p-2 border">20~39ì´ˆ</td><td class="p-2 border">20ì´ˆ ë¯¸ë§Œ</td></tr>
              <tr><td class="p-2 border">í˜‘ì‘ì„± (ê³µì¡ê¸°)</td><td class="p-2 border">3íšŒ</td><td class="p-2 border">2íšŒ</td><td class="p-2 border">1íšŒ</td><td class="p-2 border">0íšŒ</td></tr>
            </tbody>
        </table>
        <p class="text-xs text-gray-500 text-center mt-2">â€» ë³¸ ê¸°ì¤€ì€ 5~11ì„¸ ì•„ë™ì˜ ë°œë‹¬ íŠ¹ì„±ì„ ê³ ë ¤í•˜ì—¬ ì½”í¬ë‹ˆì§ ì•„ë™ ë°œë‹¬ ì—°êµ¬ì§„ì´ ì§ì ‘ ì—°êµ¬ ë° ê²€ì¦í•œ ê¸°ì¤€ì…ë‹ˆë‹¤.</p>
      `;

      document.getElementById('papsStandard').innerHTML = `
        <table class="w-full text-xs table-auto border">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="p-2 border">í•­ëª©</th>
              <th class="p-2 border">1ë“±ê¸‰</th>
              <th class="p-2 border">2ë“±ê¸‰</th>
              <th class="p-2 border">3ë“±ê¸‰</th>
              <th class="p-2 border">4ë“±ê¸‰</th>
              <th class="p-2 border">5ë“±ê¸‰</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p-2 border">ìœ ì—°ì„± (ì¢Œì „êµ´)</td>
              <td class="p-2 border">15cm ì´ìƒ</td>
              <td class="p-2 border">10~14cm</td>
              <td class="p-2 border">5~9cm</td>
              <td class="p-2 border">1~4cm</td>
              <td class="p-2 border">0cm ì´í•˜</td>
            </tr>
            <tr>
              <td class="p-2 border">ê·¼ë ¥ (ìœ—ëª¸ì¼ìœ¼í‚¤ê¸°)</td>
              <td class="p-2 border">35íšŒ ì´ìƒ</td>
              <td class="p-2 border">30~34íšŒ</td>
              <td class="p-2 border">25~29íšŒ</td>
              <td class="p-2 border">20~24íšŒ</td>
              <td class="p-2 border">19íšŒ ì´í•˜</td>
            </tr>
            <tr>
              <td class="p-2 border">ìˆœë°œë ¥ (ë©€ë¦¬ë›°ê¸°)</td>
              <td class="p-2 border">160cm ì´ìƒ</td>
              <td class="p-2 border">150~159cm</td>
              <td class="p-2 border">140~149cm</td>
              <td class="p-2 border">130~139cm</td>
              <td class="p-2 border">129cm ì´í•˜</td>
            </tr>
            <tr>
              <td class="p-2 border">ë¯¼ì²©ì„± (50m ë‹¬ë¦¬ê¸°)</td>
              <td class="p-2 border">10ì´ˆ ì´í•˜</td>
              <td class="p-2 border">10.1~11ì´ˆ</td>
              <td class="p-2 border">11.1~12ì´ˆ</td>
              <td class="p-2 border">12.1~13ì´ˆ</td>
              <td class="p-2 border">13.1ì´ˆ ì´ìƒ</td>
            </tr>
            <tr>
              <td class="p-2 border">í‰í˜•ì„± (í•œë°œì„œê¸°)</td>
              <td class="p-2 border">60ì´ˆ ì´ìƒ</td>
              <td class="p-2 border">45~59ì´ˆ</td>
              <td class="p-2 border">30~44ì´ˆ</td>
              <td class="p-2 border">15~29ì´ˆ</td>
              <td class="p-2 border">14ì´ˆ ì´í•˜</td>
            </tr>
            <tr>
              <td class="p-2 border">í˜‘ì‘ì„± (ê³µì¡ê¸°)</td>
              <td class="p-2 border">60íšŒ ì´ìƒ</td>
              <td class="p-2 border">50~59íšŒ</td>
              <td class="p-2 border">40~49íšŒ</td>
              <td class="p-2 border">30~39íšŒ</td>
              <td class="p-2 border">29íšŒ ì´í•˜</td>
            </tr>
          </tbody>
        </table>
        <p class="text-xs text-gray-500 text-center mt-2">â€» ë³¸ ê¸°ì¤€ì€ PAPS ì²´ë ¥ë“±ê¸‰ ë° êµ­ë‚´ ìœ ì†Œë…„ ì²´ë ¥ í‘œì¤€ì„ ì°¸ê³ í•˜ì—¬ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
      `;
    });
  </script>
</div>
</body>
  </html>
